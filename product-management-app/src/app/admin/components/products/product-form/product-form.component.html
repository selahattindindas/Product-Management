<div class="modal-dialog-content">
  <div class="modal-header">
    <h5 class="modal-title">
      {{ isEditMode ? 'Ürün Düzenle' : 'Yeni Ürün Ekle' }}
    </h5>
    <button type="button" class="btn-close" (click)="onCancel()"></button>
  </div>

  <div class="modal-body">
    @if (isInitialLoading()) {
      <div class="text-center py-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Yükleniyor...</span>
        </div>
        <p class="mt-2">Ürün bilgileri yükleniyor...</p>
      </div>
    } @else {
      @if (errorMessage) {
        <div class="alert alert-danger" role="alert">
          {{ errorMessage }}
        </div>
      }

      <form [formGroup]="productForm" (ngSubmit)="onSubmit()" novalidate>

        <div class="mb-3">
          <label for="name" class="form-label">
            Ürün Adı <span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="name"
            class="form-control"
            formControlName="name"
            appValidation="required"
            placeholder="Ürün adını giriniz"
          />
        </div>

        <div class="mb-3">
          <label for="description" class="form-label">Açıklama</label>
          <textarea
            id="description"
            class="form-control"
            formControlName="description"
            appValidation="maxlength:500"
            rows="3"
            placeholder="Ürün açıklamasını giriniz (isteğe bağlı)"
          ></textarea>
        </div>

        <!-- Price and Category Row -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="price" class="form-label">
              Fiyat <span class="text-danger">*</span>
            </label>
            <div class="input-group">
              <span class="input-group-text">₺</span>
              <input
                type="number"
                id="price"
                class="form-control"
                formControlName="price"
                appValidation="required"
                placeholder="0.00"
                step="0.01"
                min="0.01"
              />
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="categoryId" class="form-label">
              Kategori <span class="text-danger">*</span>
            </label>
            <select
              id="categoryId"
              class="form-select"
              formControlName="categoryId"
              appValidation="required"
            >
              <option value="" disabled>Kategori seçiniz</option>
              @for (category of listCategory(); track category.id) {
                <option [value]="category.id">{{ category.name }}</option>
              }
            </select>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">
            Renkler <span class="text-danger">*</span>
          </label>
          <div class="color-selection-container">
            @if (listColor().length > 0) {
              <div class="color-grid">
                @for (color of listColor(); track color.id) {
                  <div 
                    class="color-option"
                    [class.selected]="isColorSelected(color.id)"
                    (click)="toggleColorSelection(color.id)"
                  >
                    <div 
                      class="color-preview" 
                      appColorFill
                      [appColorFill]="color.name"
                      [title]="color.name"
                    ></div>
                    <span class="color-name">{{ color.name }}</span>
                    @if (isColorSelected(color.id)) {
                      <div class="checkmark">✓</div>
                    }
                  </div>
                }
              </div>
            } @else {
              <div class="text-muted">Renk yükleniyor...</div>
            }
          </div>

          <input
            type="hidden"
            formControlName="colorIds"
            appValidation="required"
          />
          <div class="form-text">En az bir renk seçiniz</div>
        </div>
      </form>
    }
  </div>

  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-secondary"
      (click)="onCancel()"
      [disabled]="isLoading"
    >
      {{ cancelButtonText }}
    </button>
    <button
      type="button"
      class="btn btn-primary"
      (click)="onSubmit()"
      [disabled]="productForm.invalid || isInitialLoading() || isLoading"
    >
      @if (isLoading) {
        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        Kaydediliyor...
      } @else {
        {{ submitButtonText || (isEditMode ? 'Güncelle' : 'Ürün Oluştur') }}
      }
    </button>
  </div>
</div>
